var __reflect=this&&this.__reflect||function(e,t,n){e.__class__=t,n?n.push(t):n=[t],e.__types__=e.__types__?n.concat(e.__types__):n},__extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n},__awaiter=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{p(r.next(e))}catch(t){o(t)}}function s(e){try{p(r["throw"](e))}catch(t){o(t)}}function p(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}p((r=r.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;p;)try{if(i=1,o&&(a=o[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return p.label++,{value:n[1],done:!1};case 5:p.label++,o=n[1],n=[0];continue;case 7:n=p.ops.pop(),p.trys.pop();continue;default:if(a=p.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){p=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){p.label=n[1];break}if(6===n[0]&&p.label<a[1]){p.label=a[1],a=n;break}if(a&&p.label<a[2]){p.label=a[2],p.ops.push(n);break}a[2]&&p.ops.pop(),p.trys.pop();continue}n=t.call(e,p)}catch(r){n=[6,r],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,p={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},UIBase=function(e){function t(){var n=e.call(this)||this;return n.AdaptType=t.Adapt2,n.isOpenMovie=!1,n.isFlashBg=!1,n.addEventListener(egret.Event.ADDED_TO_STAGE,n.OnOpen,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.OnClose,n),n}return __extends(t,e),t.prototype.OnOpen=function(){this.AdaptScreen(),this.isOpened=!0,this.tap_mask&&this.tap_mask.addEventListener(egret.TouchEvent.TOUCH_TAP,this.OnTapMask,this)},t.prototype.OnClose=function(){this.isOpened=!1,this.flashbg_Timer&&this.flashbg_Timer.stop()},t.prototype.Open=function(e){void 0===e&&(e=App.layer.playLayer);for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=e||App.layer.playLayer;switch(r){case App.layer.playLayer:this.OpenInPlayLayer();break;case App.layer.tipLayer:this.OpenInOtherLayer(r);break;default:r.addChild(this)}},t.prototype.OpenInPlayLayer=function(){App.layer.playLayer.numChildren>0&&App.layer.playLayer.removeChildren(),App.layer.playLayer.addChild(this)},t.prototype.OpenInOtherLayer=function(e){for(var t=e.numChildren,n=0;t>n;n++)e.getChildAt(n).visible=!1;e.addChild(this)},t.prototype.Close=function(){if(this.parent&&this){var e=this.parent;switch(e.removeChild(this),e){case App.layer.tipLayer:this.CloseFromOtherLayer(e)}}},t.prototype.CloseFromOtherLayer=function(e){var t=e.numChildren;t>0&&(e.getChildAt(t-1).visible=!0)},t.prototype.AdaptScreen=function(){if(this.content){var e=Utils.Screen.width,t=Utils.Screen.height;if(e>t){var n=e;e=t,t=n}var r=App.StageSize.width,i=App.StageSize.height,o=Math.floor(e/t*100),a=Math.floor(r/i*100);if(this.content.anchorOffsetX=this.content.width/2,this.content.anchorOffsetY=this.content.height/2,a>o){var s=e/t*i;this.content.scaleX=this.content.scaleY=s/r,1==this.AdaptType&&(this.content.height=r*(t/e))}if(o>a){var p=t/e*r;this.content.scaleX=this.content.scaleY=p/i,1==this.AdaptType&&(this.content.width=i*(e/t))}}},t.prototype.OnTapMask=function(){this.Close()},t.prototype.AdaptIphoneX=function(){this.AdaptType!=t.Adapt2&&WXHelper.isWxgame&&this.topBar&&(this.topBar.top=WXHelper.instance.isIPhoneX?55:0)},t.prototype.AdaptFullScreen=function(){this.AdaptType!=t.Adapt2&&WXHelper.isWxgame&&this.topBar&&(this.topBar.top=Utils.isFullScreen?55:0)},t.prototype.OpenMovies=function(){if(this.isOpenMovie){var e=this.content.scaleX;this.content.scaleX=this.content.scaleY=e/2,egret.Tween.get(this.content).to({scaleX:e,scaleY:e},100)}},t.prototype.FlashStripeBg=function(){var e=this;this.isFlashBg&&this.stripe&&(this.flashbg_Timer||(this.flashbg_Timer=new egret.Timer(200,0),this.flashbg_Timer.addEventListener(egret.TimerEvent.TIMER,function(){e.stripe.verticalCenter=0==e.stripe.verticalCenter?8:0},this)),this.flashbg_Timer.reset(),this.flashbg_Timer.start())},t.Adapt1=1,t.Adapt2=2,t}(eui.Component);__reflect(UIBase.prototype,"UIBase");var Platfrom_WX=function(){function e(){this.name="wxgame"}return e.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,App.user.user_info]})})},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){return[2,new Promise(function(t,n){WXHelper.instance.getUserInfo().then(function(n){e.InitUserData(n),t()})["catch"](function(){WXHelper.instance.getUserInfoBtn.show(),WXHelper.instance.getUserInfoBtn.onTap(function(n){"getUserInfo:ok"==n.errMsg&&(WXHelper.instance.getUserInfoBtn.hide(),e.InitUserData(n.userInfo),t())})})})]})})},e.prototype.InitUserData=function(e){App.user.InitUserInfo({name:e.nickName,avater:e.avatarUrl})},e}();__reflect(Platfrom_WX.prototype,"Platfrom_WX",["Platform"]);var Main=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(e){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var t=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(e){console.log(e)})},t.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return WXHelper.isWxgame&&(window.platform=new Platfrom_WX),[4,this.loadResource()];case 1:return t.sent(),[4,RES.getResAsync("description_json")];case 2:return e=t.sent(),SocketHelper.instance.Connect(),App.gameStage=this.stage,App.layer.InitLayer(App.gameStage),this.createGameScene(),[2]}})})},t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,4,,5]),e=new LoadingUI,this.stage.addChild(e),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return n.sent(),[4,this.loadTheme()];case 2:return n.sent(),[4,RES.loadGroup("preload",0,e)];case 3:return n.sent(),this.stage.removeChild(e),[3,5];case 4:return t=n.sent(),console.error(t),[3,5];case 5:return[2]}})})},t.prototype.loadTheme=function(){var e=this;return new Promise(function(t,n){var r=new eui.Theme("resource/default.thm.json",e.stage);r.addEventListener(eui.UIEvent.COMPLETE,function(){t()},e)})},t.prototype.createGameScene=function(){var e=this;SocketHelper.instance.on(SocketHelper.cmd_s_c.conn,function(){e.OnConnected()},this)},t.prototype.OnConnected=function(){SocketHelper.instance.InitListener(),App.panel.login.Open()},t}(eui.UILayer);__reflect(Main.prototype,"Main");var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,n,r){function i(e){t.call(r,e)}function o(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),n.call(r))}var a=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){t.call(r,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(e,n){window.JSONParseClass.setData(e),egret.callLater(function(){t.call(r,generateEUI2)},a)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(e.indexOf(".exml")>-1){var s=e.split("/");s.pop();var p=s.join("/")+"_EUI.json";generateJSON.paths[e]?egret.callLater(function(){t.call(r,generateJSON.paths[e])},this):RES.getResByUrl(p,function(n){window.JSONParseClass.setData(n),egret.callLater(function(){t.call(r,generateJSON.paths[e])},a)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){t.call(r,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),RES.getResByUrl(e,i,this,RES.ResourceItem.TYPE_TEXT)},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var AudioManager=function(){function e(){this._BGM_Volume=50,this._GAME_Volume=50,this._sounds={}}return Object.defineProperty(e.prototype,"BGM_Volume",{get:function(){return this._BGM_Volume},set:function(e){this._BGM_Volume=e,this._sounds[SoundName.BGM]&&this._sounds[SoundName.BGM].setvolume(this.BGM_Volume)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"GAME_Volume",{get:function(){return this._GAME_Volume},set:function(e){this._GAME_Volume=e;for(var t in this._sounds)t!=SoundName.BGM&&this._sounds[t].setvolume(this._GAME_Volume)},enumerable:!0,configurable:!0}),e.prototype.OnAppPause=function(){for(var e in this._sounds)this._sounds[e].OnPause()},e.prototype.OnAppResume=function(){for(var e in this._sounds)this._sounds[e].OnResume()},e.prototype.initSounds=function(){var e=this,t=SoundName.AllAudios;t.forEach(function(t){e._sounds[t]=new AudioItem(t)}),this.BGM_Volume=100,this.GAME_Volume=100},e.prototype.Play=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=1),this._sounds[e]&&this._sounds[e].play(t,n)},e.prototype.Stop=function(e){this._sounds[e]&&this._sounds[e].stop()},e.prototype.SetVolume=function(e,t){this._sounds[e]&&this._sounds[e].setvolume(t)},e}();__reflect(AudioManager.prototype,"AudioManager");var AudioItem=function(){function e(e){this.isPlaying=!1,this.vol=100,this.sound=RES.getRes(e),this.soundChannel=null}return e.prototype.play=function(e,t){var n=this;this.isPlaying,this.isPlaying=!0,this.soundChannel=this.sound.play(e,t),this.loop=t,this.soundChannel.volume=this.vol/100,this.soundChannel.addEventListener(egret.Event.SOUND_COMPLETE,function(){n.isPlaying=!1},this)},e.prototype.stop=function(){this.isPlaying&&this.soundChannel&&(this.soundChannel.stop(),this.isPlaying=!1)},e.prototype.setvolume=function(e){0>e&&(e=0),e>100&&(e=100),this.vol=e,this.isPlaying&&this.soundChannel&&(this.soundChannel.volume=this.vol/100)},e.prototype.OnPause=function(){this.isPlaying&&(this.pos=this.soundChannel.position,this.soundChannel.stop())},e.prototype.OnResume=function(){var e=this;this.isPlaying&&(this.soundChannel=this.sound.play(this.pos,this.loop),this.soundChannel.volume=this.vol/100,this.soundChannel.addEventListener(egret.Event.SOUND_COMPLETE,function(){e.isPlaying=!1},this))},e}();__reflect(AudioItem.prototype,"AudioItem");var SoundName=function(){function e(){}return Object.defineProperty(e,"AllAudios",{get:function(){return[this.roleMove,this.eatStar,this.gameWin,this.gameDead,this.heroRevive,this.stabProp,this.btnMove]},enumerable:!0,configurable:!0}),e.BGM="temp_bgm_6_mp3",e.roleMove="roleMove_mp3",e.eatStar="eatStar_mp3",e.gameWin="win_mp3",e.gameDead="dead_mp3",e.heroRevive="herorevive_mp3",e.stabProp="stabProp_mp3",e.btnMove="btnMove_mp3",e}();__reflect(SoundName.prototype,"SoundName");var ConfigManager=function(){function e(){this._shareInfo={imgs:["share_001.jpg","share_002.jpg","share_003.jpg"],msg:["这几个像素人，你选哪个？","这像素迷宫你能穿越第几层？","像素游戏，童年的回忆"]},this._icons=["001_png","002_png","003_png","004_png","005_png","006_png","007_png","008_png"]}return Object.defineProperty(e.prototype,"shareMsg",{get:function(){var e=this._shareInfo.msg.length,t=Math.floor(Math.random()*e);return this._shareInfo.msg[t]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shareImg",{get:function(){var e=this._shareInfo.imgs.length,t=Math.floor(Math.random()*e);return"resource/assets/views/share/"+this._shareInfo.imgs[t]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shareInfo",{get:function(){var e=this._shareInfo.msg.length,t=Math.floor(Math.random()*e);return{msg:this._shareInfo.msg[t],img:"resource/assets/views/share/"+this._shareInfo.imgs[t]}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"RandomIcon",{get:function(){var e=this._icons.length,t=Math.floor(Math.random()*e);return this._icons[t]},enumerable:!0,configurable:!0}),e}();__reflect(ConfigManager.prototype,"ConfigManager");var EventManager=function(){function e(){this.EList={}}return e.prototype.addListener=function(e,t,n){this.EList[e]||(this.EList[e]=[]);for(var r=this.EList[e].length,i=0;r>i;i++)if(this.EList[e][i].callBack==t&&this.EList[e][i].callBackObj==n)return void console.log("不可重复监听！");var o=new EventData(t,n);this.EList[e].push(o)},e.prototype.delListener=function(e,t,n){if(this.EList[e])for(var r=this.EList[e].length,i=0;r>i;i++)if(this.EList[e][i].callBack===t){if(!n){this.EList[e].splice(i,1);break}if(this.EList[e][i].callBackObj===n){this.EList[e].splice(i,1);break}}0==this.EList[e].length&&delete this.EList[e]},e.prototype.disListener=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(this.EList[e])for(var r=this.EList[e].length,i=0;r>i;i++)this.EList[e][i].callBack&&(t?(o=this.EList[e][i].callBack).call.apply(o,[this.EList[e][i].callBackObj].concat(t)):this.EList[e][i].callBack.call(this.EList[e][i].callBackObj,""));var o},e}();__reflect(EventManager.prototype,"EventManager");var EventData=function(){function e(e,t){this.callBack=e,this.callBackObj=t}return e}();__reflect(EventData.prototype,"EventData");var EventName;!function(e){e[e.TestEvent1=0]="TestEvent1",e[e.TestEvent2=1]="TestEvent2",e[e.UpdateManual=2]="UpdateManual",e[e.GameOver=3]="GameOver",e[e.NewMessage=4]="NewMessage"}(EventName||(EventName={}));var LayerManager=function(){function e(){this.Excs=[0,0],this.GlobalScale=1}return e.prototype.InitLayer=function(e){this._stage=new egret.DisplayObjectContainer,e.addChild(this._stage),this.AdapterWindow(),this._playLayer=new egret.DisplayObjectContainer,this._stage.addChild(this._playLayer),this._tipLayer=new egret.DisplayObjectContainer,this._stage.addChild(this._tipLayer),this._loadingLayer=new egret.DisplayObjectContainer,this._stage.addChild(this._loadingLayer)},e.prototype.AdapterWindow=function(){var e=Utils.Screen.width,t=Utils.Screen.height;if(e>t){var n=e;e=t,t=n}var r=App.StageSize.width,i=App.StageSize.height,o=Math.floor(e/t*100),a=Math.floor(r/i*100);if(a>o){var s=e/t*i;this._stage.x+=(s-r)/2,console.log("全面",s),this.Excs=[(s-r)/2,0],this.GlobalScale=s/r}if(o>a){var p=t/e*r;this._stage.y+=(p-i)/2,console.log("ipad",p),this.Excs=[0,(p-i)/2],this.GlobalScale=p/i}},Object.defineProperty(e.prototype,"playLayer",{get:function(){return this._playLayer||this.InitLayer(App.gameStage),this._playLayer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tipLayer",{get:function(){return this._tipLayer||this.InitLayer(App.gameStage),this._tipLayer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loadingLayer",{get:function(){return this._loadingLayer||this.InitLayer(App.gameStage),this._loadingLayer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stage",{get:function(){return this._stage||this.InitLayer(App.gameStage),this._stage},enumerable:!0,configurable:!0}),e}();__reflect(LayerManager.prototype,"LayerManager");var PanelManager=function(){function e(){}return Object.defineProperty(e.prototype,"play",{get:function(){return this._play||(this._play=new PlayPanel),this._play},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"match",{get:function(){return this._match||(this._match=new MatchPanel),this._match},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"login",{get:function(){return this._login||(this._login=new LoginPanel),this._login},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"confirm",{get:function(){return this._confirm||(this._confirm=new ConfirmPanel),this._confirm},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"result",{get:function(){return this._result||(this._result=new ResultPanel),this._result},enumerable:!0,configurable:!0}),e}();__reflect(PanelManager.prototype,"PanelManager");var PlayManager=function(){function e(){this.row=17,this._manual=[],this._map=[],this.meChess=1,this._rival=null}return e.prototype.addManual=function(e,t,n){this._manual.push([e,t,n]),App.event.disListener(EventName.UpdateManual)},Object.defineProperty(e.prototype,"Manual",{get:function(){return this._manual||[]},enumerable:!0,configurable:!0}),e.prototype.InitGame=function(e){this._manual=[],this.meChess=e.chess,this.roomid=e.roomid,this._rival=e.rival},Object.defineProperty(e.prototype,"Me",{get:function(){return this.meChess},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isMeDraw",{get:function(){var e=this.Manual.length;return 0==e?1==this.Me:this.Manual[e-1][0]!=this.Me},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rival",{get:function(){return this._rival},enumerable:!0,configurable:!0}),e}();__reflect(PlayManager.prototype,"PlayManager");var UserManager=function(){function e(){this._UserDB={name:"",avater:"",uid:""},this.isLogin=!1}return Object.defineProperty(e.prototype,"user_info",{get:function(){return this._UserDB},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"user_name",{get:function(){return this._UserDB.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"user_id",{get:function(){return this._UserDB.uid},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"user_avater",{get:function(){return this._UserDB.avater},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"user_openid",{get:function(){return this.openId},set:function(e){this.openId=e,console.log("this.openId",this.openId)},enumerable:!0,configurable:!0}),e.prototype.InitUserInfo=function(e){this._UserDB=e,this.isLogin=!0},e}();__reflect(UserManager.prototype,"UserManager");var WSManager=function(){function e(){}return e}();__reflect(WSManager.prototype,"WSManager");var DebugPlatform=function(){function e(){this.name="debug"}return e.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,App.user.user_info]})})},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){return[2,new Promise(function(t,n){SocketHelper.instance.emit(SocketHelper.cmd_c_s.login,""),SocketHelper.instance.on(SocketHelper.cmd_s_c.login,function(e){App.user.InitUserInfo({avater:"",name:e}),t()},e)})]})})},e}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},t.prototype.onProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var SocketHelper=function(){function e(){}return Object.defineProperty(e,"instance",{get:function(){return this._ins||(this._ins=new e),this._ins},enumerable:!0,configurable:!0}),e.prototype.Connect=function(){var t="debug"==window.env?e.ServerIP_deb:e.ServerIP_pub;this._socket=io(t)},e.prototype.emit=function(e,t){this._socket.emit(e,t)},e.prototype.on=function(e,t,n){this._socket.on(e,function(e){void 0===e&&(e=""),t.call(n,e)})},e.prototype.InitListener=function(){e.instance.on(e.cmd_s_c.draw,function(e){var t=JSON.parse(e);App.play.addManual(t[0],t[1],t[2])},this),e.instance.on(e.cmd_s_c.over,function(t){var n=JSON.parse(t),r="",i=!1;n.winer&&(r=n.winer==App.user.user_id?"YOU WIN!":"YOU LOSE!",i=n.winer==App.user.user_id),n.loser&&(r=n.loser!=App.user.user_id?"YOU WIN!":"YOU LOSE!",i=n.loser!=App.user.user_id),ResultPanel.Show(i).then(function(){App.event.disListener(EventName.GameOver)}),e.instance.emit(e.cmd_c_s.over,"")},this),e.instance.on(e.cmd_s_c.msg,function(e){var t=JSON.parse(e);App.event.disListener(EventName.NewMessage,t)},this)},e.ServerIP_deb="http://172.21.50.30:3002",e.ServerIP_pub="http://45.76.10.80:3002",e.cmd_c_s={login:"login",match:"match",draw:"draw",over:"over",msg:"msg"},e.cmd_s_c={login:"login",match:"match",draw:"draw",over:"over",conn:"conn",msg:"msg"},e}();__reflect(SocketHelper.prototype,"SocketHelper");var App=function(){function e(){}return Object.defineProperty(e,"layer",{get:function(){return this._layer||(this._layer=new LayerManager),this._layer},enumerable:!0,configurable:!0}),Object.defineProperty(e,"panel",{get:function(){return this._panel||(this._panel=new PanelManager),this._panel},enumerable:!0,configurable:!0}),Object.defineProperty(e,"play",{get:function(){return this._play||(this._play=new PlayManager),this._play},enumerable:!0,configurable:!0}),Object.defineProperty(e,"event",{get:function(){return this._event||(this._event=new EventManager),this._event},enumerable:!0,configurable:!0}),Object.defineProperty(e,"audio",{get:function(){return this._audio||(this._audio=new AudioManager),this._audio},enumerable:!0,configurable:!0}),Object.defineProperty(e,"user",{get:function(){return this._user||(this._user=new UserManager),this._user},enumerable:!0,configurable:!0}),Object.defineProperty(e,"config",{get:function(){return this._config||(this._config=new ConfigManager),this._config},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ws",{get:function(){return this._ws||(this._ws=new WSManager),this._ws},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ENV",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(e,"StageSize",{get:function(){return{width:640,height:1136}},enumerable:!0,configurable:!0}),e}();__reflect(App.prototype,"App");var AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,n){function r(r){t.call(n,r,e)}if(RES.hasRes(e)){var i=RES.getRes(e);i?r(i):RES.getResAsync(e,r,this)}else RES.getResByUrl(e,r,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var Utils=function(){function Utils(){}return Utils.WriteLocalStorage=function(e,t){return window.localStorage?(window.localStorage.setItem(e,t),!0):(console.log("浏览器不支持LocalStorage"),!1)},Utils.ReadLocalStorage=function(e){return window.localStorage?window.localStorage.getItem(e):(console.log("浏览器不支持LocalStorage"),null)},Utils.DeleteLocalStorage=function(e){return window.localStorage?(window.localStorage.removeItem(e),!0):(console.log("浏览器不支持LocalStorage"),!1)},Utils.GetRandomNum=function(e,t){var n=t-e+1;return Math.floor(Math.random()*n+e)},Utils.getProbability=function(e){return Math.random()>1-e},Utils.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];switch(e.length){case 1:console.log(e[0]);break;case 2:console.log(e[0],e[1]);break;case 3:console.log(e[0],e[1],e[2]);break;default:console.log(e)}},Utils.CompVersion=function(e,t){var n=e.split("."),r=t.split("."),i=1e6*parseInt(n[0])+1e3*parseInt(n[1])+parseInt(n[2]),o=1e6*parseInt(r[0])+1e3*parseInt(r[1])+parseInt(r[2]);return i==o?0:i>o?1:o>i?-1:void 0},Utils.ToBoolean=function(e){var t=!0;return e&&0!=e&&"false"!=e||(t=!1),e},Object.defineProperty(Utils,"isFullScreen",{get:function(){var e=window.screen.availWidth,t=window.screen.availHeight;return t/e>16/9},enumerable:!0,configurable:!0}),Utils.CompareOneDay=function(e,t){var n=new Date(e),r=new Date(t);return n.getFullYear()==r.getFullYear()&&n.getMonth()==r.getMonth()&&n.getDate()==r.getDate()},Object.defineProperty(Utils,"Screen",{get:function(){var e=window.innerWidth||window.screen.availWidth,t=window.innerHeight||window.screen.availHeight;return{width:e,height:t}},enumerable:!0,configurable:!0}),Utils.RandomHz=function(l){void 0===l&&(l=1);for(var rsl="",i=0;l>i;i++){var word="";eval('word="\\u'+(Math.round(20901*Math.random())+19968).toString(16)+'"'),rsl+=word}return rsl},Utils.DefaultColor={black:65793,yellow:16774656,purple:14024959,red:16711680,green:65280},Utils}();__reflect(Utils.prototype,"Utils");var LocalStorage_Key=function(){function e(){}return e.GOLD="gold",e.BAG="bag",e.UseSkin="uskin",e.Power="power",e.LastUpdatePower="LU_power",e.Progress="progress",e.ShareRecord_1="sharerecord_1",e.RecordFC="fc_rcd",e.RecordSD="sd_rcd",e.RecordGD="gd_rcd",e.RecordAdNum="adn_rcd",e.playerLevelOne="playerLevelOne",e.playerLevelTwo="playerLevelTwo",e}();__reflect(LocalStorage_Key.prototype,"LocalStorage_Key");var ConfirmPanel=function(e){function t(){var t=e.call(this)||this;return t.skinName=ConfirmSkin,t}return __extends(t,e),t.prototype.OnOpen=function(){e.prototype.OnOpen.call(this)},t.prototype.OnClose=function(){e.prototype.OnClose.call(this)},t.prototype.Open=function(t,n){var r=this;e.prototype.Open.call(this,t),this.msgLabel.textFlow=(new egret.HtmlTextParser).parser(n.msg);var i=n.type||"confirm";return this.currentState=i,new Promise(function(e,t){r.yesBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){r.Close(),e()},r),r.noBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){r.Close(),t()},r)})},t.Show=function(e,t){return App.panel.confirm.Open(App.layer.loadingLayer,{msg:e,type:t})},t}(UIBase);__reflect(ConfirmPanel.prototype,"ConfirmPanel");var LoginPanel=function(e){function t(){var t=e.call(this)||this;return t.skinName=LoginPanelSkin,t}return __extends(t,e),t.prototype.OnOpen=function(){var t=this;e.prototype.OnOpen.call(this),this._avater=App.config.RandomIcon,this.icon.source=this._avater,this.nameIn.text=Utils.RandomHz(Math.floor(4*Math.random())+2),this.loginBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.OnLoginTap,this),SocketHelper.instance.on(SocketHelper.cmd_s_c.login,function(e){var n=JSON.parse(e);n.errCode?ConfirmPanel.Show("昵称重复！","alert"):ConfirmPanel.Show("登录成功！","alert").then(function(){App.user.InitUserInfo({avater:t._avater,name:n.name,uid:n.id}),t.Close(),App.panel.match.Open()})},this)},t.prototype.OnClose=function(){e.prototype.OnClose.call(this)},t.prototype.OnLoginTap=function(){var e=this.nameIn.text||"";if(0==e.length)return void ConfirmPanel.Show("请输入昵称！","alert");if(e.length>9)return void ConfirmPanel.Show("昵称长度为 1-9 个字符！","alert");var t={name:e,icon:this._avater};SocketHelper.instance.emit(SocketHelper.cmd_c_s.login,JSON.stringify(t))},t}(UIBase);__reflect(LoginPanel.prototype,"LoginPanel");var MatchPanel=function(e){function t(){var t=e.call(this)||this;return t.skinName=MatchPanelSkin,t}return __extends(t,e),t.prototype.OnOpen=function(){e.prototype.OnOpen.call(this),this.currentState=t.StateAuto,this.nick.text=App.user.user_name,this.icon.source=App.user.user_avater,this.matchBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.OnMatchTap,this)},t.prototype.OnClose=function(){e.prototype.OnClose.call(this)},t.prototype.OnMatchTap=function(){var e=this;this.currentState=t.StateIng,this.mtip.text="MATCHING...",this.MatchUser().then(function(n){console.log("----",n),App.play.InitGame({roomid:n.roomid,chess:n.chess_b==App.user.user_id?1:2,rival:n.rival}),e.mtip.text=App.user.user_name+"\n\nVS\n\n"+n.rival.name,setTimeout(function(){e.currentState=t.StateAuto,e.Close(),App.panel.play.Open()},3e3)})},t.prototype.MatchUser=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){return[2,new Promise(function(t,n){SocketHelper.instance.emit(SocketHelper.cmd_c_s.match,""),SocketHelper.instance.on(SocketHelper.cmd_s_c.match,function(e){t(JSON.parse(e))},e)})]})})},t.StateAuto="auto",t.StateIng="ing",t}(UIBase);__reflect(MatchPanel.prototype,"MatchPanel");var Message=function(e){function t(){var t=e.call(this)||this;return t.skinName=MessageSkin,t.addEventListener(egret.Event.ADDED_TO_STAGE,t.OnOpen,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.OnClose,t),t}return __extends(t,e),t.prototype.OnOpen=function(){this.quickBox.y=0,this.moreBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.OnMoreTap,this),this.qk_list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.OnQkTap,this),this.sendBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.OnSendTap,this)},t.prototype.OnClose=function(){},t.prototype.OnSendTap=function(){this.quickBox.y=0;var e=this.msgLabel.text||"";return e?(this.msgLabel.text="",void SocketHelper.instance.emit(SocketHelper.cmd_c_s.msg,JSON.stringify({msg:e}))):void ConfirmPanel.Show("消息不能为空！","alert")},t.prototype.OnMoreTap=function(){0==this.quickBox.y?egret.Tween.get(this.quickBox).to({y:-200},100):egret.Tween.get(this.quickBox).to({y:0},100)},t.prototype.OnQkTap=function(){var e=this.qk_list.selectedItem;this.msgLabel.text=e.msg,egret.Tween.get(this.quickBox).to({y:0},100)},t}(eui.Component);__reflect(Message.prototype,"Message");var PlayPanel=function(e){function t(){var t=e.call(this)||this;return t.skinName=PlayPanelSkin,t.AdaptType=UIBase.Adapt1,t}return __extends(t,e),t.prototype.OnOpen=function(){e.prototype.OnOpen.call(this),this.InitMapBg(),this.hasChess.text=1==App.play.Me?"你执黑子":"你执白子",this.drawTip.text="黑棋先手",this.InitPlayers(),this.tapMask.addEventListener(egret.TouchEvent.TOUCH_TAP,this.OnMaskTap,this),App.event.addListener(EventName.UpdateManual,this.UpdateChess,this),App.event.addListener(EventName.GameOver,this.OnGameOver,this),App.event.addListener(EventName.NewMessage,this.OnNewMsg,this)},t.prototype.InitPlayers=function(){this.icon_p2.source=App.user.user_avater,this.name_p2.text=App.user.user_name,this.chess_p2.text=1==App.play.Me?"黑子":"白子",this.msg_p2.visible=!1,this.icon_p1.source=App.play.rival.icon,this.name_p1.text=App.play.rival.name,this.chess_p1.text=1!=App.play.Me?"黑子":"白子",this.msg_p1.visible=!1},t.prototype.OnClose=function(){e.prototype.OnClose.call(this),this._chessPg&&this._chessPg.graphics.clear(),App.event.delListener(EventName.UpdateManual,this.UpdateChess,this),App.event.delListener(EventName.GameOver,this.OnGameOver,this),App.event.delListener(EventName.NewMessage,this.OnNewMsg,this)},t.prototype.OnNewMsg=function(e){e.id==App.user.user_id?this.MeSay(e.msg):this.OtherSay(e.msg)},t.prototype.MeSay=function(e){var t=this;this.timer_me||(this.timer_me=new egret.Timer(2e3,1),this.timer_me.addEventListener(egret.TimerEvent.TIMER_COMPLETE,function(){t.msg_p2.visible=!1},this)),this.msg_p1.visible=!1,this.msg_p2.visible=!0,this.msg2.text=e,this.timer_other&&this.timer_other.reset(),this.timer_me.reset(),this.timer_me.start()},t.prototype.OtherSay=function(e){var t=this;this.timer_other||(this.timer_other=new egret.Timer(2e3,1),this.timer_other.addEventListener(egret.TimerEvent.TIMER_COMPLETE,function(){t.msg_p1.visible=!1},this)),this.msg_p2.visible=!1,this.msg_p1.visible=!0,this.msg1.text=e,this.timer_me&&this.timer_me.reset(),this.timer_other.reset(),this.timer_other.start()},t.prototype.InitMapBg=function(){var e=new egret.Shape;this.mapbg.removeChildren(),this.mapbg.addChild(e);var t=600/App.play.row;e.width=e.height=600,e.graphics.lineStyle(2,0);for(var n=0;n<App.play.row;n++)e.graphics.moveTo((n+.5)*t,.5*t),e.graphics.lineTo((n+.5)*t,(App.play.row-.5)*t);for(var n=0;n<App.play.row;n++)e.graphics.moveTo(.5*t,(n+.5)*t),e.graphics.lineTo((App.play.row-.5)*t,(n+.5)*t);e.graphics.endFill(),e.alpha=.5},t.prototype.UpdateChess=function(){var e=this;this._chessPg||(this._chessPg=new egret.Shape,this.chessBox.addChild(this._chessPg)),this._chessPg.graphics.clear(),App.play.Manual.forEach(function(t){e.DrawChess(t[0],t[1],t[2])}),this.drawTip.text=App.play.isMeDraw?"到你落子...":"对方落子..."},t.prototype.DrawChess=function(e,t,n){var r=600/App.play.row,i=1==e?0:16777215;this._chessPg.graphics.beginFill(i),this._chessPg.graphics.drawCircle((t+.5)*r,(n+.5)*r,r/3),this._chessPg.graphics.endFill()},t.prototype.OnMaskTap=function(e){if(App.play.isMeDraw){var t=[e.localX,e.localY],n=600/App.play.row,r=[Math.floor(t[0]/n),Math.floor(t[1]/n)],i=r[0],o=r[1];
if(this.CheckIsEmpty(i,o)){console.log(i,o);var a={roomid:App.play.roomid,step:[App.play.Me,i,o],manual:App.play.Manual};console.log(JSON.stringify(a)),SocketHelper.instance.emit(SocketHelper.cmd_c_s.draw,JSON.stringify(a))}}},t.prototype.CheckIsEmpty=function(e,t){return 0==App.play.Manual.filter(function(n){return n[1]==e&&n[2]==t}).length},t.prototype.OnGameOver=function(){this.Close(),App.panel.match.Open()},t}(UIBase);__reflect(PlayPanel.prototype,"PlayPanel");var ResultPanel=function(e){function t(){var t=e.call(this)||this;return t.skinName=ResultPanelSkin,t}return __extends(t,e),t.prototype.OnOpen=function(){var n=this;e.prototype.OnOpen.call(this),this.currentState=this._rsl?t.StateVic:t.StateDef,this.tipLB.verticalCenter=0,this.yesBtn.visible=!1,egret.Tween.get(this.tipLB).wait(100).to({verticalCenter:-340},700).call(function(){n.yesBtn.visible=!0})},t.prototype.OnClose=function(){e.prototype.OnClose.call(this)},t.prototype.Open=function(t,n){return __awaiter(this,void 0,void 0,function(){var r=this;return __generator(this,function(i){return[2,new Promise(function(i,o){r._rsl=n,e.prototype.Open.call(r,t),r.yesBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){r.Close(),i()},r)})]})})},t.Show=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,App.panel.result.Open(App.layer.tipLayer,e)]})})},t.StateVic="vic",t.StateDef="def",t}(UIBase);__reflect(ResultPanel.prototype,"ResultPanel");var ShareHelper=function(){function e(){}return e.Share=function(e){var t=this;return new Promise(function(e,n){WXHelper.instance.shareMsg(t.getShareObj()).then(function(){e()})["catch"](function(){n()})})},e.getShareObj=function(){var e=App.config.shareInfo,t={title:e.msg,imageUrl:e.img};return t},Object.defineProperty(e,"isOpenRtMsg",{get:function(){var t=(new Date).getTime();return t>e.OpenRtTime},enumerable:!0,configurable:!0}),e.OpenRtTime=0,e}();__reflect(ShareHelper.prototype,"ShareHelper");var SharePoint=function(){function e(){}return e.share_p1={sure:""},e.share_p2={sure:"成功获得体力"},e.share_p3={sure:"成功获得盾牌"},e.share_p4={sure:"成功获得复活无敌"},e.share_p5={sure:"分享成功"},e.share_p6={sure:"成功获得金币"},e}();__reflect(SharePoint.prototype,"SharePoint");var WXHelper=function(){function e(){}return Object.defineProperty(e,"instance",{get:function(){return this._instance||(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),Object.defineProperty(e,"isWxgame",{get:function(){return platform.name&&"wxgame"==platform.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"getSystemInfoSync",{get:function(){return this._systemInfo||(this._systemInfo=wx.getSystemInfoSync()),this._systemInfo},enumerable:!0,configurable:!0}),e.prototype.showToast=function(e,t){wx.showToast({title:e,icon:t})},e.prototype.exitMiniProgram=function(){wx.exitMiniProgram()},e.prototype.getUserInfo=function(){return new Promise(function(e,t){wx.getUserInfo({success:function(t){e(t.userInfo)},fail:function(e){t(e)}})})},e.prototype.createUserInfoBtn=function(){var e=window.screen.availWidth,t=window.screen.availHeight,n=.4625*e,r=.3243*n;return wx.createUserInfoButton({type:"image",image:"resource/assets/views/big/ld_btn_ksyx.png",style:{left:(e-n)/2,top:.7764*t,width:n,height:r,backgroundColor:"#ccc000",borderColor:"#000000",borderWidth:0,borderRadius:0,textAlign:"center",fontSize:30,lineHeight:40},withCredentials:!1})},Object.defineProperty(e.prototype,"getUserInfoBtn",{get:function(){return this._getUserInfoBtn||(this._getUserInfoBtn=this.createUserInfoBtn()),this._getUserInfoBtn},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"WX_OpenDataContext",{get:function(){return this._openDataContext||(this._openDataContext=wx.getOpenDataContext()),this._openDataContext},enumerable:!0,configurable:!0}),e.prototype.shareMsg=function(e){return new Promise(function(t,n){function r(){var e=(new Date).getTime();e-i>=2500?t():n(),wx.offShow(r)}var i=(new Date).getTime(),o={title:e.title,imageUrl:e.imageUrl||"aa.png",query:e.query||"action=share"};console.log("shareInfo:",o),wx.shareAppMessage(o),wx.onShow(r)})},e.prototype.setUserCloudStorage=function(t,n){e.instance.WX_OpenDataContext.postMessage({command:"updateScore",score:t,lv:n})},Object.defineProperty(e.prototype,"clubBtn",{get:function(){if(!this._clubBtn){var t=window.screen.availWidth;window.screen.availHeight,e.instance.getSystemInfoSync.model;this._clubBtn=wx.createGameClubButton({icon:"white",style:{left:.8*t-40,top:Utils.isFullScreen?114:74,width:40,height:40}})}return this._clubBtn},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isIPhoneX",{get:function(){var t=e.instance.getSystemInfoSync.model;return-1!=t.indexOf("iPhone X")},enumerable:!0,configurable:!0}),e}();__reflect(WXHelper.prototype,"WXHelper");var WXVideoAd=function(){function e(){this.adUnitId="adunit-6ccde69a23bb03d6",this.needSDKVersion="2.0.4",this.isListenLocalClose=!1}return Object.defineProperty(e,"instance",{get:function(){return this._instance||(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.isSDKVersionOK=function(){if(!WXHelper.isWxgame)return!1;var e=WXHelper.instance.getSystemInfoSync,t=Utils.CompVersion(e.SDKVersion,this.needSDKVersion);return t>=0},e.prototype.createAd=function(){return this.isSDKVersionOK?(this._ad=wx.createRewardedVideoAd({adUnitId:this.adUnitId}),void(this.isListenLocalClose||(this._ad.onClose(this.OnAdClose),this.isListenLocalClose=!0))):null},e.prototype.LookAd=function(e){var t=this;return new Promise(function(n,r){t._ad&&t.adUnitId==e||(t.adUnitId=e,t.createAd()),t._ad||r({errCode:10001}),t._ad.onClose(function(e){e&&e.isEnded||void 0===e?n():r({errCode:10003})}),t._ad.onError(function(e){r({errCode:10002})}),t._ad.show()["catch"](function(){t._ad.load().then(function(){t._ad.show()})})})},e.prototype.OnAdClose=function(e){e&&e.isEnded||void 0===e},e.prototype.loadAd=function(){var e=this;this._ad.load().then(function(){e._ad.show()})["catch"](function(){e.loadAd()})},e.prototype.OnCloseAd=function(){this._ad.onClose(function(e){e&&e.isEnded||void 0===e})},e}();__reflect(WXVideoAd.prototype,"WXVideoAd");var VideoAd_AID=function(){function e(){}return e.aid1="adunit-6ccde69a23bb03d6",e.aid2="adunit-abd35fda2e16a3ad",e}();__reflect(VideoAd_AID.prototype,"VideoAd_AID");